<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SamyAI - Vision</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0e0e10] text-gray-100 font-sans h-screen flex flex-col">

    <header class="p-4 flex justify-between items-center border-b border-gray-800">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-bold">S</div>
            <span class="text-xl font-semibold">SamyAI</span>
        </div>
    </header>

    <main id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-8 max-w-4xl mx-auto w-full">
        <div id="welcome-message" class="mt-20 text-center">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-indigo-500 bg-clip-text text-transparent italic">SamyAI</h1>
            <p class="text-gray-500">Posez une question ou analysez une image.</p>
        </div>
    </main>

    <div class="p-6">
        <div class="max-w-4xl mx-auto bg-[#1c1c1f] rounded-3xl p-2 border border-gray-800 shadow-2xl">
            <div id="preview-container" class="hidden p-2">
                <img id="image-preview" src="" class="h-20 w-20 object-cover rounded-xl border border-gray-700">
            </div>
            
            <div class="flex items-center gap-3 px-4 py-2">
                <label class="cursor-pointer hover:text-blue-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                    <input type="file" id="image-input" accept="image/*" class="hidden" onchange="handleImagePreview(this)">
                </label>
                <input id="user-input" type="text" placeholder="Demandez n'importe quoi à SamyAI..." class="flex-1 bg-transparent border-none outline-none text-white py-2">
                <button onclick="sendToSamy()" class="bg-white text-black h-10 w-10 rounded-full flex items-center justify-center font-bold">↑</button>
            </div>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const imageInput = document.getElementById('image-input');
        const previewContainer = document.getElementById('preview-container');

        function handleImagePreview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('image-preview').src = e.target.result;
                    previewContainer.classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
        });

        async function sendToSamy() {
            const input = document.getElementById('user-input');
            const file = imageInput.files[0];
            const text = input.value.trim();

            if (!text && !file) return;
            if (document.getElementById('welcome-message')) document.getElementById('welcome-message').remove();

            let imgUrl = file ? URL.createObjectURL(file) : null;
            appendMessage('user', text, imgUrl);

            input.value = '';
            imageInput.value = '';
            previewContainer.classList.add('hidden');

            let imageBase64 = file ? await toBase64(file) : null;

            try {
                // REMPLACE L'ADRESSE CI-DESSOUS PAR TON LIEN RENDER + /chat
                const response = await fetch('http://localhost:3000/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: text, image: imageBase64 })
                });
                const data = await response.json();
                appendMessage('assistant', data.response);
            } catch (e) {
                appendMessage('assistant', "Erreur : Vérifie que le serveur est lancé.");
            }
        }

        function appendMessage(role, text, img) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `<div class="${role === 'user' ? 'bg-blue-700 p-4 rounded-2xl max-w-[80%]' : 'w-full py-4 text-gray-200'}">
                ${img ? `<img src="${img}" class="max-w-xs rounded-lg mb-2 shadow-lg">` : ''}
                <p>${text}</p>
            </div>`;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    </script>
</body>
</html>